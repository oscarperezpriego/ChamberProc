<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Michael Strupler, Jesús Fernandez Habas, Adrián González Guzmán,Vidal Barrón López de Torre, Oscar Pérez-Priego">
<meta name="dcterms.date" content="2024-06-11">

<title>ChamberFlux (working title)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="outline_publication_files/libs/clipboard/clipboard.min.js"></script>
<script src="outline_publication_files/libs/quarto-html/quarto.js"></script>
<script src="outline_publication_files/libs/quarto-html/popper.min.js"></script>
<script src="outline_publication_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="outline_publication_files/libs/quarto-html/anchor.min.js"></script>
<link href="outline_publication_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="outline_publication_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="outline_publication_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="outline_publication_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="outline_publication_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ChamberFlux (working title)</h1>
<p class="subtitle lead">An adapted version of the R package “RespChamberFlux” to calculate gas fluxes measured with the PICARRO system (SUBTITLE TO BE ADAPTED)”</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Michael Strupler, Jesús Fernandez Habas, Adrián González Guzmán,Vidal Barrón López de Torre, Oscar Pérez-Priego </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 11, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell">

</div>
<div class="cell">

</div>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<section id="background-and-challenges" class="level2">
<h2 class="anchored" data-anchor-id="background-and-challenges">Background and Challenges</h2>
<p>[Broad overview about gas flux measurements in general] Measuring gas fluxes in a chamber provides useful information on plant-atmosphere interactions and processes (e.g.&nbsp;REF). However, each measurement includes systematic and random errors (e.g. <span class="citation" data-cites="Perez-Priego2015">Pérez-Priego et al. (<a href="#ref-Perez-Priego2015" role="doc-biblioref">2015</a>)</span>)</p>
<p>The package <em>RespChamberFlux</em> (<span class="citation" data-cites="RespChamberProc">Wutzler and Priego (<a href="#ref-RespChamberProc" role="doc-biblioref">2024</a>)</span>) derives fluxes from a time series of gas concentrations in a chamber. It has been successfully used in past studies (<span class="citation" data-cites="Perez-Priego2015a">O. Perez-Priego et al. (<a href="#ref-Perez-Priego2015a" role="doc-biblioref">2015</a>)</span>,<span class="citation" data-cites="Perez-Priego2021">Oscar Perez-Priego (<a href="#ref-Perez-Priego2021" role="doc-biblioref">2021</a>)</span>) for chamber measurements with a LI-840 infrared gas analyzer (IRGA LI-840, Lincoln, NE, USA) system. The chambers were equipped with different sensors to acquire environmental variables, and specifically the gases CO2 and H2O.</p>
<p>[Quickly introduce Picarro system]: The <em>Picarro</em> system (REF) has been used for various gas flux measurements for various settings, including field campaigns executed by the Agronomy Department of the University of Córdoba, Spain (ADD REFS TO STUDIES). An advantage of the Picarro system is that it can measure a broad range of gases from a chamber, including CO2, H2O, N2O, NH3, AND CH4. However, various environmental variables, including Temperature, Atmospheric Pressure, relative humidity, and shortwave radiation were not measured during the above mentionend campaigns.</p>
<p>To our knowledge, no evaluation of the measurement times needed for each gas to minimize systematic and aleatory errors, exists.</p>
</section>
<section id="aims-and-structure-of-this-article" class="level2">
<h2 class="anchored" data-anchor-id="aims-and-structure-of-this-article">Aims and structure of this article</h2>
<p>In this article, we present <em>[NEWPACKAGENAME]</em> that builds on the R (<span class="citation" data-cites="RSoftware">R Core Team (<a href="#ref-RSoftware" role="doc-biblioref">2024</a>)</span>) package <em>RespChamberFlux</em> (<span class="citation" data-cites="RespChamberProc">Wutzler and Priego (<a href="#ref-RespChamberProc" role="doc-biblioref">2024</a>)</span>), suited for the use with the <em>Picarro</em> system (Reference). We demonstrate the use of the package for Picarro measurement data from two case studies located in Córdoba, Spain (ADD STUDY SITE FIGURE) with different aims. Furthermore, we systematically test the gas-specific measurement times in the Picarro system that are needed in order to minimize the measurement error. Based on our findings, we provide recommendations for minimizing systematic and random errors when measuring with the Picarro system.</p>
</section>
<section id="respchamberproc" class="level2">
<h2 class="anchored" data-anchor-id="respchamberproc">RespChamberProc</h2>
<p>To provide the reader with the necessary background how RespChamberProc (<span class="citation" data-cites="RespChamberProc">Wutzler and Priego (<a href="#ref-RespChamberProc" role="doc-biblioref">2024</a>)</span>) works, a quick overview of RespChamberFlux is provided in the following. As stated above, the package was developed to compute the fluxes and to estimate the associated errors for gases for a chamber. Generally, the package performs the following steps:</p>
<ol type="1">
<li>data loading</li>
<li>corrections of units and gas densities (Gases have to be in dry mole fractions)</li>
<li>identification of single measurement chunks (labelled with an index variable)</li>
<li>estimation of the fluxes and their respective errors</li>
</ol>
<p>For <em>[NEWPACKAGENAME]</em>, the here presented Picarro-adapted version of RespChamberProc, we demonstrate each of these steps based on example data in the results section.</p>
</section>
</section>
<section id="methodology" class="level1">
<h1>Methodology</h1>
<p>All calculations in this article are executed using R Statistical Software version 4.4.0 (<span class="citation" data-cites="RSoftware">R Core Team (<a href="#ref-RSoftware" role="doc-biblioref">2024</a>)</span>).</p>
<section id="adapting-respchamberproc-to-use-with-the-picarro-system" class="level2">
<h2 class="anchored" data-anchor-id="adapting-respchamberproc-to-use-with-the-picarro-system">Adapting RespChamberProc to use with the Picarro system</h2>
<p>We extended the package <em>RespChamberFlux</em> (<span class="citation" data-cites="RespChamberProc">Wutzler and Priego (<a href="#ref-RespChamberProc" role="doc-biblioref">2024</a>)</span>) by various functionalities:</p>
<ul>
<li>Time intervals in the raw data from Picarro are irregular <span class="math inline">\(\rightarrow\)</span> convertToRegularTimesteps</li>
<li>A function was implemented that downloads additional environmental parameters automatically for selected coordinates using the packages “openmeteo” (<span class="citation" data-cites="Openmeteo">Pisel (<a href="#ref-Openmeteo" role="doc-biblioref">2023</a>)</span>) and “elevatr” (<span class="citation" data-cites="ElevatR">Hollister et al. (<a href="#ref-ElevatR" role="doc-biblioref">2023</a>)</span>).</li>
</ul>
</section>
<section id="analyzing-the-gas-specific-measurement-times-needed-for-error-minimization" class="level2">
<h2 class="anchored" data-anchor-id="analyzing-the-gas-specific-measurement-times-needed-for-error-minimization">Analyzing the gas-specific measurement times needed for error minimization</h2>
<p>We analyze the gas-specific measurement times that are needed for the used set-up in order to minimize the errors by [create plots!] <!-- How do fluxes and uncertainties vary with the selection of the calculation window? --> ======= ## Background</p>
<ul>
<li>gas flux measurements</li>
<li>Picarro</li>
</ul>
</section>
<section id="aims-and-structure-of-this-article-1" class="level2">
<h2 class="anchored" data-anchor-id="aims-and-structure-of-this-article-1">Aims and structure of this article</h2>
<p>In this article, we present <em>[NEWPACKAGENAME]</em>, which is an adapted version of the R (<span class="citation" data-cites="RSoftware">R Core Team (<a href="#ref-RSoftware" role="doc-biblioref">2024</a>)</span>) package <em>RespChamberFlux</em> (<span class="citation" data-cites="RespChamberProc">Wutzler and Priego (<a href="#ref-RespChamberProc" role="doc-biblioref">2024</a>)</span>), suited for the use with the <em>Picarro</em> system (Reference) that measures the flux of various gases, including CO2, H2O, N2O, NH3, AND CH4.</p>
<p>We demonstrate the use of the package with data from a case study located in Córdoba, Spain (ADD STUDY SITE FIGURE).</p>
</section>
</section>
<section id="methodology-1" class="level1">
<h1>Methodology</h1>
<p>All calculations were done using R Statistical Software version 4.4.0 (<span class="citation" data-cites="RSoftware">R Core Team (<a href="#ref-RSoftware" role="doc-biblioref">2024</a>)</span>).</p>
<p>We extended the package <em>RespChamberFlux</em> (<span class="citation" data-cites="RespChamberProc">Wutzler and Priego (<a href="#ref-RespChamberProc" role="doc-biblioref">2024</a>)</span>) by various functions…</p>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<div class="cell">

</div>
<div class="cell">

</div>
<div class="cell">

</div>
<div class="cell">

</div>
<div class="cell">

</div>
<div class="cell">

</div>
<p>======= #| label: compute-fluxes #| eval: false</p>
<div class="cell">

</div>
<section id="case-study-data-jesus-how-is-the-study-site-called" class="level2">
<h2 class="anchored" data-anchor-id="case-study-data-jesus-how-is-the-study-site-called">Case study: Data Jesus (HOW IS THE STUDY SITE CALLED?)</h2>
<section id="overview-of-the-measurement-data" class="level3">
<h3 class="anchored" data-anchor-id="overview-of-the-measurement-data">Overview of the measurement data</h3>
<p>The entire time series of the Picarro measurement data on 31/05/2022 for the study site XXX (REF to figure studysite) are shown in <a href="#fig-gas_facet">Figure&nbsp;1</a>.</p>
</section>
</section>
<section id="case-study-data-jesus" class="level2">
<h2 class="anchored" data-anchor-id="case-study-data-jesus">Case study: Data Jesus</h2>
<section id="overview-of-the-measurement-data-1" class="level3">
<h3 class="anchored" data-anchor-id="overview-of-the-measurement-data-1">Overview of the measurement data</h3>
<p>First, the time series of the Picarro measurement data on 31/05/2022 for the study site XXX (REF to figure studysite) is shown (<a href="#fig-gas_facet">Figure&nbsp;1</a>).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-gas_facet" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="outline_publication_files/figure-html/fig-gas_facet-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Entire time series of for the gases CO2, H2O, CH4, NH3, and N2O measured with the Picarro system on 31/05/2022</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The function <code>subsetContiguous</code>from <em>RespChamberProc</em> subsets the entire time series into chunks that are identified by an index variable, here termed “Collar”.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-chunks" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="outline_publication_files/figure-html/fig-chunks-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Compilation of various chunks that were created from the CO2 time series</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The function <code>calcClosedChamberFlux</code> from <em>RespChamberProc</em> calculates the chamber flux for various gases and estimates the best fit, as shown in <a href="#fig-selectedchunk">Figure&nbsp;3</a> for chunk ‘4’</p>
<div id="fig-selectedchunk" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-selectedchunk-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="outline_publication_files/figure-html/fig-selectedchunk-1.png" class="img-fluid figure-img" data-ref-parent="fig-selectedchunk" width="672"></p>
<p></p><figcaption class="figure-caption">(a) CO2</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-selectedchunk-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="outline_publication_files/figure-html/fig-selectedchunk-2.png" class="img-fluid figure-img" data-ref-parent="fig-selectedchunk" width="672"></p>
<p></p><figcaption class="figure-caption">(b) H2O</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-selectedchunk-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="outline_publication_files/figure-html/fig-selectedchunk-3.png" class="img-fluid figure-img" data-ref-parent="fig-selectedchunk" width="672"></p>
<p></p><figcaption class="figure-caption">(c) CH4</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-selectedchunk-4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="outline_publication_files/figure-html/fig-selectedchunk-4.png" class="img-fluid figure-img" data-ref-parent="fig-selectedchunk" width="672"></p>
<p></p><figcaption class="figure-caption">(d) NH3</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-selectedchunk-5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="outline_publication_files/figure-html/fig-selectedchunk-5.png" class="img-fluid figure-img" data-ref-parent="fig-selectedchunk" width="672"></p>
<p></p><figcaption class="figure-caption">(e) N2O</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;3: Fitted trends for a selected chunk</figcaption><p></p>
</figure>
</div>
<p>The function <code>calcClosedChamberFlux</code> from <em>RespChamberProc</em> calculates the chamber flux for various gases and provides the best fit, as shown in <a href="#fig-selectedchunk">Figure&nbsp;3</a> for chunk ‘4’</p>
</section>
</section>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
</section>
<section id="conclusions" class="level1">
<h1>Conclusions</h1>
</section>
<section id="references" class="level1 unnumbered">


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-ElevatR" class="csl-entry" role="doc-biblioentry">
Hollister, Jeffrey, Tarak Shah, Jakub Nowosad, Alec L. Robitaille, Marcus W. Beck, and Mike Johnson. 2023. <em>Elevatr: Access Elevation Data from Various APIs</em>. <a href="https://doi.org/10.5281/zenodo.8335450">https://doi.org/10.5281/zenodo.8335450</a>.
</div>
<div id="ref-Perez-Priego2015a" class="csl-entry" role="doc-biblioentry">
Perez-Priego, O., J. Guan, M. Rossini, F. Fava, T. Wutzler, G. Moreno, N. Carvalhais, et al. 2015. <span>“<span class="nocase">Sun-induced chlorophyll fluorescence and photochemical reflectance index improve remote-sensing gross primary production estimates under varying nutrient availability in a typical Mediterranean savanna ecosystem</span>.”</span> <em>Biogeosciences</em> 12 (21): 6351–67. <a href="https://doi.org/10.5194/bg-12-6351-2015">https://doi.org/10.5194/bg-12-6351-2015</a>.
</div>
<div id="ref-Perez-Priego2021" class="csl-entry" role="doc-biblioentry">
Perez-Priego, Oscar. 2021. <span>“<span>Plant Chamber Measurements</span>.”</span> In <em>Springer Handbooks</em>, 1585–1601. Springer Science; Business Media Deutschland GmbH. <a href="https://doi.org/10.1007/978-3-030-52171-4_59">https://doi.org/10.1007/978-3-030-52171-4_59</a>.
</div>
<div id="ref-Perez-Priego2015" class="csl-entry" role="doc-biblioentry">
Pérez-Priego, Oscar, Ana López-Ballesteros, Enrique P. Sánchez-Cañete, Penélope Serrano-Ortiz, Lars Kutzbach, Francisco Domingo, Werner Eugster, and Andrew S. Kowalski. 2015. <span>“<span class="nocase">Analysing uncertainties in the calculation of fluxes using whole-plant chambers: random and systematic errors</span>.”</span> <em>Plant and Soil</em> 393 (1-2): 229–44. <a href="https://doi.org/10.1007/s11104-015-2481-x">https://doi.org/10.1007/s11104-015-2481-x</a>.
</div>
<div id="ref-Openmeteo" class="csl-entry" role="doc-biblioentry">
Pisel, Tom. 2023. <em>Openmeteo: Retrieve Weather Data from the Open-Meteo API</em>. <a href="https://CRAN.R-project.org/package=openmeteo">https://CRAN.R-project.org/package=openmeteo</a>.
</div>
<div id="ref-RSoftware" class="csl-entry" role="doc-biblioentry">
R Core Team. 2024. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
<div id="ref-RespChamberProc" class="csl-entry" role="doc-biblioentry">
Wutzler, Thomas, and Oscar Perez Priego. 2024. <em>RespChamberProc: Processing Data from Respiration Chambers</em>. <a href="https://github.com/bgctw/RespChamberProc">https://github.com/bgctw/RespChamberProc</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>